
@using KLC.Models
@model PatientViewModel
@{
    ViewData["Title"] = "Statistics";
}
<link rel="stylesheet" href="~/css/NEWS.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/slider.css" asp-append-version="true" />
<div class="text-center">
    @*Historik och graf*@
	<div class="content-wrapper">
		<div class="title-section">
			<div class="patient-wrapper">
				<div class="white-on-blue">
					<p>Historik för patient @(Model.Patient.Id):</p>
				</div>
				<div>
					<p>@Model.Patient.Personnummer</p>
				</div>
			</div>
			<h1>Historik</h1>	
            <div class="options-container">
                <label for="toggle">Visa graf</label>
				<label class="switch">
                <input type="checkbox" name="toggle" id="toggle-chart" />
                <span class="slider round"></span>
            </label>
            
            </div>
	    </div>
        <div class="chart-container hide">
            <canvas class="chart top" id="simple-chart"></canvas>
        </div>
		<div class="history">
		<table>
		<tr>
			<th>Tidpunkt</th>
			<th>Andningsfrekvens</th>
			<th>Syremättnad</th>
			<th>Tillförd syrgas</th>
			<th>Systoliskt blodtryck</th>
			<th>Pulsfrekvens</th>
			<th>Medvetandegrad</th>
			<th>Temperatur</th>
		</tr>
		@*Visa tabell med värden istället för news poäng
			använder index för att visa estetiskt värde snarare än det uppmätta newsvärdet.
			3 = 0 på news skalan, +värdet på mätningen som går från -3 till +3
		*@
		@for (var i = 0; i < Model.Matningar.Count(); i++)
		{
					MatningNews2 element = @Model.Matningar[i];
					string empty = "--";

			<tr>
				<td>
					@element.TidForMatning.ToShortDateString()
					@element.TidForMatning.ToShortTimeString()
				</td>
						@if (element.Andningsfrekvens == null)
						{
							<td>@empty</td>
						}
						else
						{
						<td>@Model.Varden.Andningsfrekvens[(3+(int)element.Andningsfrekvens)]</td>
						}
						
				@* if using syremättnad2, dumt sätt att skilja på vilken som valdes är att inputs för sm2
					går från 7 till 13: 7-10 = -3
				*@
						@if(element.SyreMattnad == null)
						{
							<td>@empty</td>
						}
						else
						{
							@if(element.SyreMattnad >= 7){
							<td>@Model.Varden.SyreMattnad2[3+(int)element.SyreMattnad-10]<p>syrgas 2</p></td>
							}
							else{
							<td>@Model.Varden.SyreMattnad1[3+(int)element.SyreMattnad]</td>
							}
						}

						@if(element.TillfordSyrgas == null)
						{
							<td>@empty</td>
						}
						else
						{
							<td>@Model.Varden.TillfordSyrgas[3+(int)element.TillfordSyrgas]</td>
						}

						@if(element.SystolisktBlodtryck == null)
						{
							<td>@empty</td>
						}
						else
						{
							<td>@Model.Varden.SystolisktBlodtryck[3+(int)element.SystolisktBlodtryck]</td>
						}

						@if(element.Pulsfrekvens == null)
						{
							<td>@empty</td>
						}
						else
						{
							<td>@Model.Varden.Pulsfrekvens[3+(int)element.Pulsfrekvens]</td>
						}

						@if(element.Medvetandegrad == null)
						{
							<td>@empty</td>
						}
						else
						{
							<td>@Model.Varden.Medvetandegrad[3+(int)element.Medvetandegrad]</td>
						}

						@if(element.Temperatur == null)
						{
							<td>@empty</td>
						}
						else
						{
							<td>@Model.Varden.Temperatur[3+(int)element.Temperatur]</td>
						}
			</tr>
		}
		</table>
		
		</div>
   </div>

    <div class="controls">
	    <a  class="newsbutton submit" asp-controller="Patient" asp-action="Index">Ny mätning</a>
        <div class="separator"></div>
		<a  class="newsbutton" asp-controller="Patient" asp-action="Results">Visa åtgärd</a>
		<div class="separator"></div>

        <button class="newsbutton delete" type="submit" onclick="openPopup()">Radera senaste mätning</button>
		@* onclick="openPopup()"*@
		<div class="overlay"></div>
	<div class="popup" id="popup">
			<button class="closepopupwindow" onclick="closePopup()">X</button>

		<h2>Är du säker på att du vill radera senaste mätning?</h2>
			<form id="deleteLatest" name="deleteLatest" asp-controller="Patient" method="post" asp-action="DeleteLatestFromPatient"></form>
			<button type="submit" form="deleteLatest" onclick="closePopup()">Radera senaste</button>
			<button class="buttonNo" onclick="closePopup()">Avbryt</button>
	</div>
		<button class="newsbutton delete" type="submit" onclick="openPopup()">Radera all historik</button>
		@* onclick="openPopup()"*@
		<div class="overlay"></div>
		<div class="popup" id="popup">
			<button class="closepopupwindow" onclick="closePopup()">X</button>

			<h2>Är du säker på att du vill radera all tidigare historik?</h2>
			<form id="deleteAll" name="deleteAll" asp-controller="Patient" method="post" asp-action="DeleteAllFromPatient"></form>
			<button type="submit" form="deleteAll" onclick="closePopup()">Radera all historik</button>
			<button class="buttonNo" onclick="closePopup()">Avbryt</button>
		</div>
		@*<a  class="newsbutton" asp-controller="Patient" asp-action="Statistics">Radera senaste mätning</a>
        <a class="newsbutton delete" asp-controller="Patient" asp-action="Statistics">Radera all historik</a> *@
	</div>
    
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.js"></script>
    <script type="module">

        // importera simpel och avancerad graf
        import  simpleChart  from "/js/simpleChart.js";

		simpleChart(@Model.Patient.Id);

        //hämta html element
        const toggle = document.querySelector("#toggle-chart");
        const chart = document.querySelector(".chart-container");
		const table = document.querySelector(".history");

        //toggla mellan charts
        toggle.addEventListener("input", () => {
           chart.classList.toggle("hide");
		   table.classList.toggle("hide");
        });

    </script>
	@*script för lightboxen*@
    <script>
		// Get the popup and overlay elements
		let popup = document.getElementById("popup");
		let overlay = document.querySelector(".overlay");

		function openPopup() {
			// Show the popup and overlay
			popup.classList.add("openPopup");
			overlay.style.display = "block";
		}

		function closePopup() {
			// Hide the popup and overlay
			popup.classList.remove("openPopup");
			overlay.style.display = "none";
		}
	</script>

</div>

